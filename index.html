<!DOCTYPE html>
<html>
  <head>
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Projet AR - Bali</title>
    
    <script src="https://aframe.io/releases/1.6.0/aframe.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/mind-ar@1.2.5/dist/mindar-image-aframe.prod.js"></script>

    <style>
      body, html { margin: 0; padding: 0; width: 100%; height: 100%; overflow: hidden; }

      /* --- 1. MENU LANGUES --- */
      #lang-menu {
        position: fixed; top: 0; left: 0; width: 100%; height: 100%;
        background: #000; z-index: 10000;
        display: flex; flex-direction: column; align-items: center; justify-content: center;
        color: white; font-family: sans-serif;
      }
      .lang-grid {
        display: grid; grid-template-columns: 1fr 1fr; gap: 12px; width: 90%; max-width: 400px; margin-top: 20px;
      }
      .lang-btn {
        padding: 12px; background: rgba(255, 255, 255, 0.1); color: white; border: 1px solid rgba(255,255,255,0.4);
        border-radius: 15px; font-size: 15px; cursor: pointer; display: flex; align-items: center; gap: 10px;
      }
      .lang-btn img { width: 25px; border-radius: 2px; }

      /* --- 2. MESSAGE ET BOUTON SUR LA CAM√âRA --- */
      #scan-message {
        display: none; 
        position: absolute; bottom: 30px; left: 50%; transform: translateX(-50%);
        background: rgba(0, 0, 0, 0.8); color: white; padding: 12px 25px;
        border-radius: 30px; z-index: 9999; text-align: center; width: 80%; font-family: sans-serif;
      }
      
      /* NOUVEAU BOUTON : Retour au menu des langues */
      #back-to-menu-btn {
        display: none; 
        position: absolute; top: 20px; left: 20px;
        background: rgba(0, 0, 0, 0.6); color: white; border: 1px solid rgba(255,255,255,0.4);
        padding: 10px 15px; border-radius: 20px; z-index: 9999; cursor: pointer;
        font-family: sans-serif; font-size: 13px; backdrop-filter: blur(5px);
      }

      /* --- 3. VID√âO --- */
      #video-overlay {
        display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%;
        background: black; z-index: 9999;
        flex-direction: column; align-items: center; justify-content: center;
      }
      #myVideo { width: 100%; max-width: 800px; max-height: 65vh; }
      
      #close-btn {
        margin-top: 25px; padding: 12px 30px; background: none; color: white; border: 1px solid white;
        border-radius: 30px; cursor: pointer; text-transform: uppercase; font-family: sans-serif;
      }

      .hidden { display: none !important; }
    </style>
  </head>

  <body>

    <div id="lang-menu">
      <h2 style="font-weight: 300; letter-spacing: 1px;">WELCOME / BIENVENUE</h2>
      <div class="lang-grid">
        <button class="lang-btn" onclick="startCamera('fr')"><img src="https://flagcdn.com/w40/fr.png"> Fran√ßais</button>
        <button class="lang-btn" onclick="startCamera('en')"><img src="https://flagcdn.com/w40/us.png"> English</button>
        <button class="lang-btn" onclick="startCamera('es')"><img src="https://flagcdn.com/w40/es.png"> Espa√±ol</button>
        <button class="lang-btn" onclick="startCamera('it')"><img src="https://flagcdn.com/w40/it.png"> Italiano</button>
        <button class="lang-btn" onclick="startCamera('de')"><img src="https://flagcdn.com/w40/de.png"> Deutsch</button>
        <button class="lang-btn" onclick="startCamera('pt')"><img src="https://flagcdn.com/w40/pt.png"> Portugu√™s</button>
        <button class="lang-btn" onclick="startCamera('el')"><img src="https://flagcdn.com/w40/gr.png"> ŒïŒªŒªŒ∑ŒΩŒπŒ∫Œ¨</button>
        <button class="lang-btn" onclick="startCamera('ru')"><img src="https://flagcdn.com/w40/ru.png"> –†—É—Å—Å–∫–∏–π</button>
        <button class="lang-btn" onclick="startCamera('ja')"><img src="https://flagcdn.com/w40/jp.png"> Êó•Êú¨Ë™û</button>
        <button class="lang-btn" onclick="startCamera('zh')"><img src="https://flagcdn.com/w40/cn.png"> ÊôÆÈÄöËØù</button>
      </div>
    </div>

    <button id="back-to-menu-btn" onclick="window.location.reload();"></button>
    <div id="scan-message"></div>

    <div id="video-overlay">
      <video id="myVideo" playsinline webkit-playsinline controls loop>
          <source id="videoSource" src="" type="video/mp4">
      </video>
      <button id="close-btn"></button>
    </div>

    <a-scene 
      mindar-image="imageTargetSrc: ./assets/targets/targets.mind; autoStart: false; uiScanning: yes;" 
      vr-mode-ui="enabled: false" 
      device-orientation-permission-ui="enabled: false">
      <a-camera position="0 0 0" look-controls="enabled: false"></a-camera>
      <a-entity id="trigger" mindar-image-target="targetIndex: 0"></a-entity>
    </a-scene>

    <script>
      const langMenu = document.querySelector('#lang-menu');
      const scanMessage = document.querySelector('#scan-message');
      const backToMenuBtn = document.querySelector('#back-to-menu-btn');
      const videoOverlay = document.querySelector('#video-overlay');
      const video = document.querySelector('#myVideo');
      const videoSource = document.querySelector('#videoSource');
      const closeBtn = document.querySelector('#close-btn');
      const target = document.querySelector('#trigger');
      const sceneEl = document.querySelector('a-scene');
      
      let userLang = ''; 
      let isPlaying = false;

      // J'ai ajout√© la traduction pour le bouton de retour au menu
      const translations = {
        'fr': { scan: 'Visez l\'image pour commencer', back: 'Retour au scan', menu: 'üåç Langues' },
        'en': { scan: 'Please scan the image to start', back: 'Back to scan', menu: 'üåç Languages' },
        'es': { scan: 'Escanee la imagen para comenzar', back: 'Volver al escaneo', menu: 'üåç Idiomas' },
        'it': { scan: 'Scansiona l\'immagine per iniziare', back: 'Torna alla scansione', menu: 'üåç Lingue' },
        'de': { scan: 'Bitte scannen Sie das Bild, um zu starten', back: 'Zur√ºck zum Scan', menu: 'üåç Sprachen' },
        'pt': { scan: 'Digitalize a imagem para come√ßar', back: 'Voltar √† digitaliza√ß√£o', menu: 'üåç Idiomas' },
        'el': { scan: 'Œ†Œ±œÅŒ±Œ∫Œ±Œªœé œÉŒ¨œÅœâœÉŒµ œÑŒ∑ŒΩ ŒµŒπŒ∫œåŒΩŒ± Œ≥ŒπŒ± Œ≠ŒΩŒ±œÅŒæŒ∑', back: 'ŒïœÄŒπœÉœÑœÅŒøœÜŒÆ œÉœÑŒ∑ œÉŒ¨œÅœâœÉŒ∑', menu: 'üåç ŒìŒªœéœÉœÉŒµœÇ' },
        'ru': { scan: '–û—Ç—Å–∫–∞–Ω–∏—Ä—É–π—Ç–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ, —á—Ç–æ–±—ã –Ω–∞—á–∞—Ç—å', back: '–í–µ—Ä–Ω—É—Ç—å—Å—è –∫ —Å–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏—é', menu: 'üåç –Ø–∑—ã–∫–∏' },
        'ja': { scan: '„Çπ„Ç≠„É£„É≥„ÇíÈñãÂßã„Åó„Å¶„Åè„Å†„Åï„ÅÑ', back: '„Çπ„Ç≠„É£„É≥„Å´Êàª„Çã', menu: 'üåç Ë®ÄË™û' },
        'zh': { scan: 'ËØ∑Êâ´ÊèèÂõæÂÉèÂºÄÂßã', back: 'ËøîÂõûÊâ´Êèè', menu: 'üåç ËØ≠Ë®Ä' }
      };

      function startCamera(lang) {
        userLang = lang; 
        
        scanMessage.innerText = translations[lang].scan;
        closeBtn.innerText = translations[lang].back;
        backToMenuBtn.innerText = translations[lang].menu; // Applique le texte du menu
        
        langMenu.style.display = 'none';
        scanMessage.style.display = 'block';
        backToMenuBtn.style.display = 'block'; // Affiche le bouton retour

        sceneEl.systems["mindar-image-system"].start();

        setTimeout(() => {
          window.dispatchEvent(new Event('resize'));
        }, 500);
      }

      target.addEventListener("targetFound", () => {
        if (!isPlaying && userLang !== '') {
          isPlaying = true;

          scanMessage.style.display = 'none';
          backToMenuBtn.style.display = 'none'; // On cache le bouton pendant la vid√©o
          const ui = document.querySelector('.mindar-ui-scanning');
          if(ui) ui.classList.add('hidden');

          videoSource.src = `./assets/videos/video_${userLang}.mp4`;
          video.load(); 
          videoOverlay.style.display = 'flex';
          video.play();
        }
      });

      closeBtn.addEventListener("click", () => {
        video.pause();
        videoSource.src = ""; 
        video.load();

        videoOverlay.style.display = 'none';
        scanMessage.style.display = 'block';
        backToMenuBtn.style.display = 'block'; // On remet le bouton quand on revient √† la cam√©ra

        const ui = document.querySelector('.mindar-ui-scanning');
        if(ui) ui.classList.remove('hidden');

        setTimeout(() => { isPlaying = false; }, 1000);
      });
    </script>
  </body>
</html>
