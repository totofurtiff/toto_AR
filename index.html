<!DOCTYPE html>
<html>
  <head>
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
    <title>Projet AR - Bali Burger Menu</title>
    
    <script src="https://aframe.io/releases/1.6.0/aframe.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/mind-ar@1.2.5/dist/mindar-image-aframe.prod.js"></script>

    <style>
      body, html { margin: 0; width: 100%; height: 100%; overflow: hidden; background: #000; font-family: 'Segoe UI', sans-serif; }
      .a-canvas { width: 100% !important; height: 100% !important; }

      /* --- MENU BURGER --- */
      #burger-icon {
        position: fixed;
        top: 20px; right: 20px;
        width: 30px; height: 25px;
        z-index: 20000;
        cursor: pointer;
        display: flex;
        flex-direction: column;
        justify-content: space-between;
      }
      #burger-icon span { display: block; height: 4px; width: 100%; background: white; border-radius: 2px; transition: 0.3s; }

      #side-menu {
        position: fixed;
        top: 0; right: -250px; width: 250px; height: 100%;
        background: rgba(0, 0, 0, 0.95);
        z-index: 19999;
        transition: 0.4s;
        display: flex;
        flex-direction: column;
        padding-top: 80px;
        border-left: 1px solid rgba(255,255,255,0.2);
      }
      #side-menu.open { right: 0; }
      #side-menu a {
        color: white; text-decoration: none; padding: 20px; font-size: 18px;
        border-bottom: 1px solid rgba(255,255,255,0.1); text-transform: uppercase;
      }

      /* --- ECRANS --- */
      #welcome-overlay {
        position: fixed; top: 0; left: 0; width: 100%; height: 100%;
        background: #000; z-index: 10000;
        display: flex; flex-direction: column; align-items: center; justify-content: center; color: white;
      }

      .lang-grid { display: grid; grid-template-columns: 1fr; gap: 20px; width: 80%; max-width: 300px; margin-top: 30px; }
      .lang-btn {
        padding: 20px; background: rgba(255, 255, 255, 0.1); color: white;
        border: 1px solid rgba(255,255,255,0.4); border-radius: 20px; font-size: 18px;
        cursor: pointer; display: flex; align-items: center; justify-content: center; gap: 15px;
      }
      .lang-btn img { width: 35px; border-radius: 4px; }

      #scan-message {
        display: none; position: fixed; bottom: 40px; left: 50%; transform: translateX(-50%);
        background: rgba(0, 0, 0, 0.8); color: white; padding: 15px 30px;
        border-radius: 40px; z-index: 900; text-align: center; width: 80%;
      }

      #video-overlay {
        display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%;
        background: black; z-index: 9999; flex-direction: column; align-items: center; justify-content: center; 
      }
      video { width: 100%; max-height: 80vh; background: #000; }

      .hidden { display: none !important; }
    </style>
  </head>

  <body>

    <div id="burger-icon" onclick="toggleMenu()">
      <span></span><span></span><span></span>
    </div>

    <div id="side-menu">
      <a href="#" onclick="navTo('home')">üè† Home / Langues</a>
      <a href="#" onclick="navTo('scan')">üì∑ Scan AR</a>
      <a href="#" onclick="navTo('video')">üé¨ Voir Vid√©o</a>
    </div>

    <div id="welcome-overlay">
      <h2 style="font-weight: 300; letter-spacing: 2px;">SELECT LANGUAGE</h2>
      <div class="lang-grid">
        <button class="lang-btn" onclick="setLanguageAndStart('fr')"><img src="https://flagcdn.com/w40/fr.png"> Fran√ßais</button>
        <button class="lang-btn" onclick="setLanguageAndStart('en')"><img src="https://flagcdn.com/w40/us.png"> English</button>
      </div>
    </div>

    <div id="scan-message"></div>

    <div id="video-overlay">
      <video id="myVideo" playsinline controls loop></video>
      <p style="color: white; margin-top: 10px; font-size: 12px; opacity: 0.5;">Use menu to go back</p>
    </div>

    <a-scene 
      id="ar-scene"
      mindar-image="imageTargetSrc: ./assets/targets/targets.mind; autoStart: false; uiScanning: no;" 
      embedded vr-mode-ui="enabled: false" device-orientation-permission-ui="enabled: false">
      <a-camera position="0 0 0" look-controls="enabled: false"></a-camera>
      <a-entity id="target0" mindar-image-target="targetIndex: 0"></a-entity>
    </a-scene>

    <script>
      const welcome = document.querySelector('#welcome-overlay');
      const scanMsg = document.querySelector('#scan-message');
      const videoOverlay = document.querySelector('#video-overlay');
      const video = document.querySelector('#myVideo');
      const sideMenu = document.querySelector('#side-menu');
      const sceneEl = document.querySelector('#ar-scene');
      
      let userLang = 'en';
      let videoLoaded = false;

      const texts = {
        'fr': { scan: 'Visez l\'image pour commencer' },
        'en': { scan: 'Scan the image to start' }
      };

      // MENU LOGIQUE
      function toggleMenu() { sideMenu.classList.toggle('open'); }

      function navTo(page) {
        toggleMenu();
        video.pause();
        videoOverlay.style.display = 'none';
        scanMsg.style.display = 'none';
        welcome.classList.add('hidden');

        if(page === 'home') {
          location.reload(); // Plus propre pour r√©initialiser totalement l'AR
        } else if (page === 'scan') {
          scanMsg.style.display = 'block';
        } else if (page === 'video') {
          if(videoLoaded) {
            videoOverlay.style.display = 'flex';
            video.play();
          } else {
            alert(userLang === 'fr' ? "Veuillez d'abord scanner une image" : "Please scan an image first");
            scanMsg.style.display = 'block';
          }
        }
      }

      // INITIALISATION
      function setLanguageAndStart(lang) {
        userLang = lang;
        welcome.classList.add('hidden');
        scanMsg.innerText = texts[lang].scan;
        scanMsg.style.display = 'block';
        sceneEl.systems['mindar-image-system'].start(); 
      }

      // DETECTION
      document.querySelector('#target0').addEventListener("targetFound", () => {
        scanMsg.style.display = 'none';
        video.src = `./assets/videos/video_${userLang}.mp4`;
        videoOverlay.style.display = 'flex';
        video.load();
        video.play();
        videoLoaded = true;
      });
    </script>
  </body>
</html>
